{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "Project": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Identifier for the project, customer or application"
      }
    },
    "Environment": {
      "type": "string",
      "allowedValues": ["dev", "test", "acc", "prod"],
      "defaultValue": "test",
      "metadata": {
        "description": "Can one of the following, dev-test-acc-prod."
      }
    },
    "WorkspaceName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the workspace used by the queries."
      }
    },
    "workbookId": {
      "defaultValue": "[newGuid()]",
      "type": "string"
    },
    "CreatedOn": {
      "defaultValue": "[utcNow()]",
      "type": "string"
    }
  },
  "variables": {
    "TemplateId": "azmon-vmworkbook",
    "TemplateVersion": "1.0.0",
    "TemplateDate": "20190515",
    "TemplateVersionDescription": "Initial version",
    "TemplateUsage": "Used to create VM workbook for given resource group and log analytics workspace.",
    "TemplateDocumentation": "<Name of document.>",
    "workbookDisplayName": "[concat(parameters('Project'), '-', parameters('Environment'), '-wbok')]"
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2018-06-17-preview",
      "tags": {
        "TemplateId": "[variables('TemplateId')]",
        "TemplateVersion": "[variables('TemplateVersion')]",
        "CreatedOn": "[parameters('CreatedOn')]",
        "Project": "[parameters('Project')]",
        "Environment": "[parameters('Environment')]"
      },
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[variables('workbookDisplayName')]",
        "serializedData": "[concat('{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[],\\\"parameters\\\":[{\\\"id\\\":\\\"6cfb5005-2b00-4d53-9847-965fe30c5f52\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"ResourceGroup\\\",\\\"type\\\":5,\\\"description\\\":\\\"Choose your Resource Group\\\",\\\"isRequired\\\":true,\\\"value\\\":\\\"monitor-test-rg\\\",\\\"isHiddenWhenLocked\\\":false,\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"jsonData\\\":\\\"[\\\\\\\"monitor-test-rg\\\\\\\",\\\\\\\"monitorvm-test-rg\\\\\\\"]\\\",\\\"timeContextFromParameter\\\":null},{\\\"id\\\":\\\"3734d8d2-9524-4686-adaa-1615de21227a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Period\\\",\\\"type\\\":4,\\\"description\\\":\\\"Sets the timerange where not fixed in query.\\\",\\\"isRequired\\\":true,\\\"value\\\":{\\\"durationMs\\\":86400000},\\\"isHiddenWhenLocked\\\":false,\\\"typeSettings\\\":{\\\"selectableValues\\\":[{\\\"durationMs\\\":3600000},{\\\"durationMs\\\":14400000},{\\\"durationMs\\\":43200000},{\\\"durationMs\\\":86400000},{\\\"durationMs\\\":172800000},{\\\"durationMs\\\":259200000},{\\\"durationMs\\\":604800000},{\\\"durationMs\\\":1209600000}]},\\\"timeContextFromParameter\\\":null},{\\\"id\\\":\\\"d410eb76-01a2-4a9a-8bfa-2b10a7611f90\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"AvailRateOverDays\\\",\\\"type\\\":2,\\\"isRequired\\\":true,\\\"value\\\":\\\"1\\\",\\\"isHiddenWhenLocked\\\":false,\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"jsonData\\\":\\\"[\\\\r\\\\n    \\\\\\\"1\\\\\\\",\\\\r\\\\n    \\\\\\\"2\\\\\\\",\\\\r\\\\n    \\\\\\\"3\\\\\\\",\\\\r\\\\n    \\\\\\\"4\\\\\\\",\\\\r\\\\n    \\\\\\\"5\\\\\\\",\\\\r\\\\n    \\\\\\\"6\\\\\\\",\\\\r\\\\n    \\\\\\\"7\\\\\\\",\\\\r\\\\n    \\\\\\\"14\\\\\\\",\\\\r\\\\n    \\\\\\\"21\\\\\\\",\\\\r\\\\n    \\\\\\\"30\\\\\\\"\\\\r\\\\n]\\\",\\\"timeContextFromParameter\\\":null}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.insights/components\\\"}\",\"conditionalVisibility\":null,\"name\":\"parameters - 2\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"# AVAILABILITY\\\\r\\\\n---\\\\r\\\\nIn this section you can find 3 items.\\\\r\\\\n\\\\r\\\\n- **Computers Reporting (24h):** Timechart that shows how much computers are reporting to the log analytics workspace over 24 hours.\\\\r\\\\n- **Availability Rate (24h):** Grid with availability rate per computer over 24 hours.\\\\r\\\\n- **Last Heartbeat > 5 minutes (24h):** Grid showing all computers with a last heartbeat that is more than 5 minutes ago in the last 24 hours.\\\\r\\\\n\\\"}\",\"conditionalVisibility\":null,\"name\":\"text - 0\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"// Computers availability today\\\\r\\\\n// Chart the number of computers sending logs, each hour\\\\r\\\\nlet ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat \\\\r\\\\n| where _ResourceId contains ResourceGroupName \\\\r\\\\n| summarize Computers = dcount(ComputerIP) by bin(TimeGenerated, 1h)    \\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Computers reporting in last 24 hours\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 5\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"// Availability rate\\\\n// Calculate the availability rate of each connected computer\\\\nlet ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\nHeartbeat\\\\n// bin_at is used to set the time grain to 1 hour, starting exactly 24 hours ago\\\\n| where _ResourceId contains ResourceGroupName\\\\n| summarize heartbeatPerHour = count() by bin_at(TimeGenerated, 1h, ago(1d)), Computer\\\\n| extend availablePerHour = iff(heartbeatPerHour > 0, true, false)\\\\n| summarize Hours = countif(availablePerHour == true) by Computer\\\\n| extend Rate = round(Hours*100.0/(1*24))\\\\n\\\",\\\"size\\\":0,\\\"exportFieldName\\\":\\\"Computer\\\",\\\"exportParameterName\\\":\\\"SelectedComputer\\\",\\\"exportDefaultValue\\\":\\\"NA\\\",\\\"title\\\":\\\"Availability Rate in the last 24 hours\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Hours\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Rate\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"85\\\",\\\"representation\\\":\\\"4\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"95\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":null,\\\"text\\\":\\\"{0}{1}\\\"}]}}],\\\"filter\\\":true}}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"AvailabilityRate\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"// Unavailable computers\\\\r\\\\n// List all known computers that did not send a heartbeat in the last 5 hours\\\\r\\\\nlet ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat \\\\r\\\\n| where _ResourceId contains ResourceGroupName \\\\r\\\\n| summarize LastHeartbeat=max(TimeGenerated) by Computer \\\\r\\\\n| where LastHeartbeat < ago(5m)\\\",\\\"size\\\":0,\\\"title\\\":\\\"Last Heartbeat > 5 minutes ago in last 24 hours\\\",\\\"noDataMessage\\\":\\\"All computers are reporting normally.\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\"}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 7\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"// Availability rate\\\\r\\\\n// Calculate the availability rate of each connected computer\\\\r\\\\nlet ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat\\\\r\\\\n// bin_at is used to set the time grain to 1 hour, starting exactly 24 hours ago\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| summarize heartbeatPerHour = count() by bin_at(TimeGenerated, 1h, ago({AvailRateOverDays}d)), Computer\\\\r\\\\n| extend availablePerHour = iff(heartbeatPerHour > 0, true, false)\\\\r\\\\n| summarize Hours = countif(availablePerHour == true) by Computer\\\\r\\\\n| extend Rate = round(Hours*100.0/({AvailRateOverDays}*24))\\\",\\\"size\\\":0,\\\"title\\\":\\\"Availability Rate over x days\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Hours\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Rate\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"85\\\",\\\"representation\\\":\\\"4\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"95\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}}]}}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 18\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"# PERFORMANCE\\\\r\\\\n---\\\\r\\\\n*Text goes here...*\\\"}\",\"conditionalVisibility\":null,\"name\":\"text - 10\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where (CounterName == \\\\\\\"% Processor Time\\\\\\\" and InstanceName == \\\\\\\"_Total\\\\\\\")\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize CPUTime = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"CPU % Total\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"Period\\\",\\\"timeBrushParameterName\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"linechart\\\"}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 12\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"System\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Processor Queue Length\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize CPUQueueLength = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"CPU Queue Length\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"timechart\\\"}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 14\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Memory\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Available MBytes\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize AvailableMB = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart   \\\",\\\"size\\\":0,\\\"title\\\":\\\"Memory Available MBytes\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 17\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Memory\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Pages/sec\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize PagesSec = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Pages / second\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 18\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"parameters\\\":[{\\\"id\\\":\\\"94f176c5-f598-4e88-805d-f9f2fcc41504\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"LogicalDisk\\\",\\\"type\\\":5,\\\"isRequired\\\":true,\\\"query\\\":\\\"Perf\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"% Free Space\\\\\\\" \\\\r\\\\n| summarize by InstanceName\\\\r\\\\n| where InstanceName !in (\\\\\\\"HarddiskVolume1\\\\\\\", \\\\\\\"_Total\\\\\\\")\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"value\\\":\\\"C:\\\",\\\"isHiddenWhenLocked\\\":false,\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"timeContextFromParameter\\\":null,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":null,\"name\":\"parameters - 13\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Free Megabytes\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{LogicalDisk}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize FreeMBonC = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Free space in MB\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 21\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Current Disk Queue Length\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{LogicalDisk}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize FreeMBonC = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Disk Queue Length\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 22\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"parameters\\\":[{\\\"id\\\":\\\"269e2935-95bd-4916-bdd2-5721b95f7e8f\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"NetworkAdapter\\\",\\\"type\\\":5,\\\"isRequired\\\":true,\\\"query\\\":\\\"Perf\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Received/sec\\\\\\\" \\\\r\\\\n| summarize by InstanceName\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"value\\\":\\\"Microsoft Hyper-V Network Adapter\\\",\\\"isHiddenWhenLocked\\\":false,\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"timeContextFromParameter\\\":null,\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"conditionalVisibility\":null,\"name\":\"parameters - 14\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Received/sec\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{NetworkAdapter}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize FreeMBonC = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Bytes Received/sec\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 15\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Sent/sec\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{NetworkAdapter}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize FreeMBonC = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart\\\",\\\"size\\\":0,\\\"title\\\":\\\"Bytes Sent/sec\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"conditionalVisibility\":null,\"name\":\"query - 16\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Perf\\\\r\\\\n| where Computer == \\\\\\\"{SelectedComputer}\\\\\\\"\\\\r\\\\n| where ObjectName == \\\\\\\"Process\\\\\\\" \\\\r\\\\n| where InstanceName !in (\\\\\\\"_Total\\\\\\\", \\\\\\\"Idle\\\\\\\")\\\\r\\\\n| summarize Average = round(avg(CounterValue),2) by InstanceName \\\\r\\\\n| sort by Average desc \\\\r\\\\n| take 10 \\\",\\\"size\\\":0,\\\"title\\\":\\\"Top 10 processes by CPU usage\\\",\\\"noDataMessage\\\":\\\"Please select machine in Availability Rate grid.\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\"}\",\"customWidth\":\"35\",\"conditionalVisibility\":null,\"name\":\"query - 17\"}],\"isLocked\":false}')]",
        "version": "1.0",
        "sourceId": "Azure Monitor",
        "category": "workbook"
      }
    }
  ]
}
