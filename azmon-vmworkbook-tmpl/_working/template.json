{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "Project": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Identifier for the project, customer or application"
      }
    },
    "Environment": {
      "type": "string",
      "allowedValues": ["dev", "test", "acc", "prod"],
      "defaultValue": "test",
      "metadata": {
        "description": "Can one of the following, dev-test-acc-prod."
      }
    },
    "WorkspaceName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the workspace used by the queries."
      }
    },
    "workbookId": {
      "defaultValue": "[newGuid()]",
      "type": "string"
    },
    "CreatedOn": {
      "defaultValue": "[utcNow()]",
      "type": "string"
    }
  },
  "variables": {
    "TemplateId": "azmon-vmworkbook",
    "TemplateVersion": "1.0.2",
    "TemplateDate": "20190523",
    "TemplateVersionDescription": "Added Top 10 processes by Memory usage (equal to by CPU usage).",
    "TemplateUsage": "Used to create VM workbook for given resource group and log analytics workspace.",
    "TemplateDocumentation": "<Name of document.>",
    "workbookDisplayName": "[concat(parameters('Project'), '-', parameters('Environment'), '-wbok')]"
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2018-06-17-preview",
      "tags": {
        "TemplateId": "[variables('TemplateId')]",
        "TemplateVersion": "[variables('TemplateVersion')]",
        "CreatedOn": "[parameters('CreatedOn')]",
        "Project": "[parameters('Project')]",
        "Environment": "[parameters('Environment')]"
      },
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[variables('workbookDisplayName')]",
        "serializedData": "[concat('{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[\\\"value::all\\\"],\\\"parameters\\\":[{\\\"id\\\":\\\"5b2e1f33-86dd-49c3-bf79-128785f8a159\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Workspace\\\",\\\"type\\\":5,\\\"isRequired\\\":true,\\\"query\\\":\\\"where type =~ \"microsoft.operationalinsights/workspaces\"\\\\r\\\\n| project name\\\\r\\\\n| order by name asc\\\",\\\"crossComponentResources\\\":[\\\"value::all\\\"],\\\"value\\\":\\\"monitor-test-lana\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"queryType\\\":1,\\\"resourceType\\\":\\\"microsoft.resourcegraph/resources\\\"},{\\\"id\\\":\\\"6cfb5005-2b00-4d53-9847-965fe30c5f52\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"ResourceGroup\\\",\\\"type\\\":5,\\\"description\\\":\\\"Choose your Resource Group\\\",\\\"isRequired\\\":true,\\\"value\\\":\\\"monitor-test-rg\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"jsonData\\\":\\\"[\\\\\\\"monitor-test-rg\\\\\\\",\\\\\\\"monitorvm-test-rg\\\\\\\"]\\\"},{\\\"id\\\":\\\"3734d8d2-9524-4686-adaa-1615de21227a\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"Period\\\",\\\"type\\\":4,\\\"description\\\":\\\"Sets the timerange where not fixed in query.\\\",\\\"isRequired\\\":true,\\\"value\\\":{\\\"durationMs\\\":86400000},\\\"typeSettings\\\":{\\\"selectableValues\\\":[{\\\"durationMs\\\":3600000},{\\\"durationMs\\\":14400000},{\\\"durationMs\\\":43200000},{\\\"durationMs\\\":86400000},{\\\"durationMs\\\":172800000},{\\\"durationMs\\\":259200000},{\\\"durationMs\\\":604800000},{\\\"durationMs\\\":1209600000}]}},{\\\"id\\\":\\\"d410eb76-01a2-4a9a-8bfa-2b10a7611f90\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"AvailRateOverDays\\\",\\\"type\\\":2,\\\"isRequired\\\":true,\\\"value\\\":\\\"14\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"jsonData\\\":\\\"[\\\\r\\\\n    \\\\\\\"1\\\\\\\",\\\\r\\\\n    \\\\\\\"2\\\\\\\",\\\\r\\\\n    \\\\\\\"3\\\\\\\",\\\\r\\\\n    \\\\\\\"4\\\\\\\",\\\\r\\\\n    \\\\\\\"5\\\\\\\",\\\\r\\\\n    \\\\\\\"6\\\\\\\",\\\\r\\\\n    \\\\\\\"7\\\\\\\",\\\\r\\\\n    \\\\\\\"14\\\\\\\",\\\\r\\\\n    \\\\\\\"21\\\\\\\",\\\\r\\\\n    \\\\\\\"30\\\\\\\"\\\\r\\\\n]\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":1,\\\"resourceType\\\":\\\"microsoft.resourcegraph/resources\\\"}\",\"name\":\"parameters - 2\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"# AVAILABILITY\\\\r\\\\n---\\\\r\\\\nIn this section you can find 4 items.\\\\r\\\\n\\\\r\\\\n- **Computers reporting in the last 24 hours:** Timechart that shows how much computers are reporting to the log analytics workspace over the last 24 hours.\\\\r\\\\n- **Availability rate in the last 24 hours (sample rate 5 minutes):** Grid with availability rate per computer over the last 24 hours. Availability sample is taken every 5 minutes.\\\\r\\\\n- **Last Heartbeat > 5 minutes ago in the last 24 hours:** Grid showing all computers with a last heartbeat that is more than 5 minutes ago in the last 24 hours.\\\\r\\\\n- ** Availability rate over {AvailRateOverDays} days (sample rate 5 minutes):** Grid with availability rate per computer over the last {AvailRateOverDays} days. Availability sample is taken every 5 minutes.\\\\r\\\\n\\\"}\",\"name\":\"text - 0\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat \\\\r\\\\n| where _ResourceId contains ResourceGroupName \\\\r\\\\n| summarize Computers = dcount(ComputerIP) by bin(TimeGenerated, 1h)    \\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Computers reporting in {Period}\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"Period\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 5\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"// Availability rate\\\\n// Calculate the availability rate of each connected computer\\\\nlet ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\nHeartbeat\\\\n| where _ResourceId contains ResourceGroupName\\\\n| summarize heartbeatPerSample = count() by bin_at(TimeGenerated, 5m, ago(1d)), Computer\\\\n| extend availablePerSample = iff(heartbeatPerSample > 0, true, false)\\\\n| summarize Samples = countif(availablePerSample == true) by Computer\\\\n| extend Rate = round(Samples*100.0/(1*(60/5)*24))\\\\n\\\",\\\"size\\\":0,\\\"exportFieldName\\\":\\\"Computer\\\",\\\"exportParameterName\\\":\\\"SelectedComputer\\\",\\\"exportDefaultValue\\\":\\\"NA\\\",\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Availability rate in the last 24 hours (sample rate 5 minutes)\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Hours\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Rate\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"85\\\",\\\"representation\\\":\\\"4\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"95\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":null,\\\"text\\\":\\\"{0}{1}\\\"}]}}],\\\"filter\\\":true}}\",\"customWidth\":\"50\",\"name\":\"AvailabilityRate\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat \\\\r\\\\n| where _ResourceId contains ResourceGroupName \\\\r\\\\n| summarize LastHeartbeat=max(TimeGenerated) by Computer \\\\r\\\\n| where LastHeartbeat < ago(5m)\\\",\\\"size\\\":0,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Last Heartbeat > 5 minutes ago in last 24 hours\\\",\\\"noDataMessage\\\":\\\"All computers are reporting normally.\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 7\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nHeartbeat\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| summarize heartbeatPerSample = count() by bin_at(TimeGenerated, 5m, ago({AvailRateOverDays}d)), Computer\\\\r\\\\n| extend availablePerSample = iff(heartbeatPerSample > 0, true, false)\\\\r\\\\n| summarize Samples = countif(availablePerSample == true) by Computer\\\\r\\\\n| extend Rate = round(Samples*100.0/({AvailRateOverDays}*(60/5)*24))\\\",\\\"size\\\":0,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Availability rate over {AvailRateOverDays} days (sample rate 5 minutes)\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"Computer\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Hours\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Rate\\\",\\\"formatter\\\":18,\\\"formatOptions\\\":{\\\"showIcon\\\":true,\\\"thresholdsOptions\\\":\\\"icons\\\",\\\"thresholdsGrid\\\":[{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"85\\\",\\\"representation\\\":\\\"4\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"<\\\",\\\"thresholdValue\\\":\\\"95\\\",\\\"representation\\\":\\\"2\\\",\\\"text\\\":\\\"{0}{1}\\\"},{\\\"operator\\\":\\\"Default\\\",\\\"thresholdValue\\\":null,\\\"representation\\\":\\\"success\\\",\\\"text\\\":\\\"{0}{1}\\\"}]}}]}}\",\"customWidth\":\"50\",\"name\":\"query - 18\"},{\"type\":1,\"content\":\"{\\\"json\\\":\\\"# PERFORMANCE\\\\r\\\\n---\\\\r\\\\nIn this section you can find the following.\\\\r\\\\n\\\\r\\\\n- **CPU % Total:** Average of CPU usage per computer sampled every 15 minutes. Note that values above 100% are possible because of multi processor systems. Also note that this graph has a time-brush system. The timeframe that you select (brush) in this graph is used in all other performance views.\\\\r\\\\n- **CPU Queue Length:** Average of CPU queue langth per computer sampled every 15 minutes.\\\\r\\\\n- **Memory Available Mbytes:** Average of available Mbytes per computer samples every 15 minutes.\\\\r\\\\n- **Pages/second:** Average of pages / second per computer sampled every 5 minutes.\\\\r\\\\n- **Free Space in MB:** Average free space in Mbytes per computer sampled every 15 minutes. The parameter above this view indicates which logical drive to report on.\\\\r\\\\n- **Disk queue length:** Average disk queue length per computer sampled every 15 minutes. The parameter above this view indicates which logical drive to report on.\\\\r\\\\n- **Bytes Received/sec:** Average bytes received per second sampled every 15 minutes. The parameter above this view indicates which network card to report on.\\\\r\\\\n- **Bytes sent/sec:** Average bytes sent per second sampled every 15 minutes. The parameter above this view indicates which network card to report on.\\\\r\\\\n- **Top 10 processes by CPU usage:** List of top 10 CPU users (average) per process. The computer being reported on can be selected in the *Availability rate in the last 24 hours* view. \\\\r\\\\n\\\"}\",\"name\":\"text - 10\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where (CounterName == \\\\\\\"% Processor Time\\\\\\\" and InstanceName == \\\\\\\"_Total\\\\\\\")\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize CPUTime = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"CPU % Total\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"Period\\\",\\\"timeBrushParameterName\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"linechart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 12\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"System\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Processor Queue Length\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize CPUQueueLength = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"CPU Queue Length\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"timechart\\\"}\",\"customWidth\":\"50\",\"name\":\"query - 14\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Memory\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Available MBytes\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize AvailableMB = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart   \\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Memory Available MBytes\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 17\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Memory\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Pages/sec\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize PagesSec = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Pages / second\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 18\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[],\\\"parameters\\\":[{\\\"id\\\":\\\"94f176c5-f598-4e88-805d-f9f2fcc41504\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"LogicalDisk\\\",\\\"type\\\":5,\\\"isRequired\\\":true,\\\"query\\\":\\\"Perf\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"% Free Space\\\\\\\" \\\\r\\\\n| summarize by InstanceName\\\\r\\\\n| where InstanceName !in (\\\\\\\"HarddiskVolume1\\\\\\\", \\\\\\\"_Total\\\\\\\")\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"value\\\":\\\"C:\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"parameters - 13\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Free Megabytes\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{LogicalDisk}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize FreeMBonC = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Free space in MB\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 21\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"LogicalDisk\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Current Disk Queue Length\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{LogicalDisk}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize DiskQueueLength = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render timechart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Disk Queue Length\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 22\"},{\"type\":9,\"content\":\"{\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"query\\\":\\\"\\\",\\\"crossComponentResources\\\":[],\\\"parameters\\\":[{\\\"id\\\":\\\"269e2935-95bd-4916-bdd2-5721b95f7e8f\\\",\\\"version\\\":\\\"KqlParameterItem/1.0\\\",\\\"name\\\":\\\"NetworkAdapter\\\",\\\"type\\\":5,\\\"isRequired\\\":true,\\\"query\\\":\\\"Perf\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Received/sec\\\\\\\" \\\\r\\\\n| summarize by InstanceName\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"value\\\":\\\"Microsoft Hyper-V Network Adapter\\\",\\\"typeSettings\\\":{\\\"additionalResourceOptions\\\":[]},\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}],\\\"style\\\":\\\"pills\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\"}\",\"name\":\"parameters - 14\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Received/sec\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{NetworkAdapter}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize BytesReceivedSec = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Bytes Received/sec\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 15\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"let ResourceGroupName = \\\\\\\"{ResourceGroup}\\\\\\\";\\\\r\\\\nPerf\\\\r\\\\n| where _ResourceId contains ResourceGroupName\\\\r\\\\n| where ObjectName == \\\\\\\"Network Adapter\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Bytes Sent/sec\\\\\\\"\\\\r\\\\n| where InstanceName == \\\\\\\"{NetworkAdapter}\\\\\\\"\\\\r\\\\n| project TimeGenerated, CounterName, CounterValue,Computer \\\\r\\\\n| summarize BytesSentSec = avg(CounterValue) by Computer, bin(TimeGenerated, 15m)\\\\r\\\\n| render areachart\\\",\\\"size\\\":0,\\\"aggregation\\\":3,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Bytes Sent/sec\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"]}\",\"customWidth\":\"50\",\"name\":\"query - 16\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Perf\\\\r\\\\n| where Computer == \\\\\\\"{SelectedComputer}\\\\\\\"\\\\r\\\\n| where ObjectName == \\\\\\\"Process\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"% Processor Time\\\\\\\" \\\\r\\\\n| where InstanceName !in (\\\\\\\"_Total\\\\\\\", \\\\\\\"Idle\\\\\\\")\\\\r\\\\n| summarize Average = round(avg(CounterValue),2) by InstanceName \\\\r\\\\n| sort by Average desc \\\\r\\\\n| take 10\\\",\\\"size\\\":0,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Top 10 processes by CPU usage\\\",\\\"noDataMessage\\\":\\\"Please select machine in Availability Rate grid.\\\",\\\"timeContext\\\":{\\\"durationMs\\\":86400000},\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"InstanceName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"Average\\\",\\\"formatter\\\":3,\\\"formatOptions\\\":{\\\"palette\\\":\\\"lightBlue\\\",\\\"showIcon\\\":true}}]}}\",\"customWidth\":\"35\",\"name\":\"query - 17\"},{\"type\":3,\"content\":\"{\\\"version\\\":\\\"KqlItem/1.0\\\",\\\"query\\\":\\\"Perf\\\\r\\\\n| where Computer == \\\\\\\"montestvm01\\\\\\\"\\\\r\\\\n| where ObjectName == \\\\\\\"Process\\\\\\\" \\\\r\\\\n| where CounterName == \\\\\\\"Private Bytes\\\\\\\" \\\\r\\\\n| where InstanceName !in (\\\\\\\"_Total\\\\\\\", \\\\\\\"Idle\\\\\\\")\\\\r\\\\n| summarize AverageMB = round(avg(CounterValue/1024/1024),2) by InstanceName \\\\r\\\\n| sort by AverageMB desc \\\\r\\\\n| take 10\\\",\\\"size\\\":0,\\\"showAnalytics\\\":true,\\\"title\\\":\\\"Top 10 processes by Memory (MB) usage\\\",\\\"timeContext\\\":{\\\"durationMs\\\":0},\\\"timeContextFromParameter\\\":\\\"TimeBrush\\\",\\\"queryType\\\":0,\\\"resourceType\\\":\\\"microsoft.operationalinsights/workspaces\\\",\\\"crossComponentResources\\\":[\\\"/subscriptions/e567a78f-72ba-4080-bb21-ca09184b1357/resourceGroups/monitor-test-rg/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'), '\\\"],\\\"visualization\\\":\\\"table\\\",\\\"gridSettings\\\":{\\\"formatters\\\":[{\\\"columnMatch\\\":\\\"InstanceName\\\",\\\"formatter\\\":0,\\\"formatOptions\\\":{\\\"showIcon\\\":true}},{\\\"columnMatch\\\":\\\"AverageMB\\\",\\\"formatter\\\":3,\\\"formatOptions\\\":{\\\"palette\\\":\\\"grayBlue\\\",\\\"showIcon\\\":true}}]}}\",\"customWidth\":\"35\",\"name\":\"query - 18\"}],\"isLocked\":False}')]",
        "version": "1.0",
        "sourceId": "Azure Monitor",
        "category": "workbook"
      }
    }
  ]
}
